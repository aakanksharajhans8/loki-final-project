# Demo Readme (gonna change later)
# Event Collector Microservice

This service is a core component of the Insurance Platform's data ingestion pipeline. Its sole responsibility is to **capture, validate, and store raw clickstream events** generated by the frontend application. It serves as the primary entry point for behavioral data into our Medallion Architecture.

---

## üéØ Core Functionality

-   **Ingestion**: Exposes a single REST endpoint to receive event data in JSON format.
-   **Validation**: Performs basic validation on incoming event payloads to ensure required fields are present.
-   **Storage**: Persists the raw, unaltered event data directly into the `bronze_insurance.clicks_raw` table in the MySQL Medallion database.

---

## API Endpoint

The service exposes one primary endpoint for ingesting events.

### `POST /events`

This endpoint accepts a single clickstream event or a batch of events.

**Example Request Body:**
```json
{
  "session_id": "a7b3c1d9-e0f1-4a2b-8c7d-6e5f4a3b2c1d",
  "user_id": "user-12345",
  "page_url": "/quote/product-selection",
  "referrer": "[https://example.com/products](https://example.com/products)",
  "device": "desktop",
  "browser": "Chrome",
  "action_type": "click",
  "element_id": "btn-get-quote",
  "timestamp": "2025-09-05T10:15:30.123Z",
  "metadata": {
    "product_id": "prod-auto-001",
    "quote_amount": 750.50
  }
}
```
### üõ†Ô∏è Tech Stack
* Framework: Spring Boot 3.5.5

* Language: Java 21

* Build Tool: Maven / Gradle

* Database Interaction: Spring Data JPA

* Database Migrations: Flyway

* API Documentation: OpenAPI (Swagger)

### üöÄ How to Run Locally
Prerequisites
* Java 21 & Maven/Gradle

* Docker

The Medallion MySQL database must be running (e.g., via the root docker-compose.yml).

Steps
1. Navigate to the service directory:
From the monorepo root:

```

cd services/event-collector
```
2. Configure the Environment:
Create a .env file in this directory with the database connection details.

Code snippet
```
# .env
DB_URL=jdbc:mysql://localhost:3306/bronze_insurance
DB_USERNAME=user
DB_PASSWORD=password
```
3. Build the Application:

```

mvn -DskipTests clean package
4. Run the Service:
You can run the application directly or use Docker.

* Directly:

```

java -jar target/event-collector-0.0.1-SNAPSHOT.jar
```
* Using Docker:

```

# Build the image first
docker build -t event-collector:local .

# Run the container
docker run --rm -p 8081:8080 --env-file ./.env --network="host" event-collector:local
```
The service will be available at http://localhost:8081.

‚úÖ How to Test
You can send a test event to the running service using a curl command.


```Bash
curl -X POST http://localhost:8081/events \
-H "Content-Type: application/json" \
-d '{
  "session_id": "test-session-123",
  "user_id": "test-user-abc",
  "page_url": "/test-page",
  "action_type": "test-click",
  "timestamp": "2025-09-05T10:20:00.000Z"
}
```
After sending the request, you can verify that a new record has been added to the bronze_insurance.clicks_raw table in your MySQL database.